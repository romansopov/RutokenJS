<html>
<head>
<title>Test</title>
</head>
<body>
<script type="text/javascript" src="const.js"></script>
<script type="text/javascript">

var rutoken = require('./rutoken/build/Release/rutoken');
var gui     = require('nw.gui');
var fs      = require('fs');

console.log(gui.App.dataPath);

console.log('initialize() ',   rutoken.initialize());

var isInitialize = rutoken.isInitialize();
console.log('isInitialize() ', isInitialize);

if(isInitialize) {

	var libInfo = rutoken.getLibInfo();
	console.log('getLibInfo: ', libInfo);

	var cntSlot = rutoken.countSlot();
	console.log('cntSlot: ', cntSlot);

	if(cntSlot > 0) {
		for(var i=0; i <= cntSlot-1; i++) {
			rutoken.getSlotInfo(i, function(data) {
				console.log('Slot info #' + i + "\n", data);
			});
			rutoken.getTokenInfo(i, function(data) {
				console.log('Token info #' + i + "\n", data);
			});
			rutoken.getMechanismList(i, function(data) {
				console.log('Mechanism list #' + i + "\n", data);
			});
		}

		if((rv = rutoken.login(0, '12345678')) == CKR_OK) {
			rutoken.random(64, function(res){
				if(typeof(res) == 'object') {
					console.log('Random success: ', res);
				} else {
					console.log('Random error: ', CKR[res]);
				}
			});
		} else {
			console.log('Login error: ' + CKR[rv]);
		}

	}

	console.log('finalize() ',   rutoken.finalize());
}

console.log('End');
</script>
</body>
</html>
